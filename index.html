<!DOCTYPE html>
<html lang="en">
  <head>
    <title>maus.to - Shorten link</title>
    <meta charset="utf-8" />
    <meta
      name="description"
      content="All the cool kids have their own link-shorteners"
    />

    <link rel="stylesheet" href="styles/site.css" />
    <link rel="icon" href="images/favicon.svg" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body>
    <header id="site-header">
      <figure id="logo" title="maus.to">
        <svg
          viewBox="0 0 75 45"
          title="Mausworks"
          preserveAspectRatio="none"
          class="mw"
          width="75"
          height="45"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            class="mw__left-cap"
            d="M0 45 L25 45 L50 0 L25 0z"
            fill="#ff9036"
          ></path>
          <path
            class="mw__back"
            d="M25 45 L75 45 L75 0 50 0z"
            fill="#1b0b0f"
          ></path>
          <path
            class="mw__mid-shard"
            d="M50 45 L50 0 L75 0z"
            fill="#8c1638"
          ></path>
        </svg>

        <figcaption>MAUS<br />.TO</figcaption>
      </figure>
    </header>
    <section id="content">
      <div class="card">
        <form id="shortener-form">
          <h1>Shorten link</h1>
          <div class="input-item">
            <label>Link</label>
            <input name="url" type="text" required autocomplete="off" />
          </div>
          <div class="input-item">
            <label>Slug</label>
            <input
              autocomplete="off"
              name="slug"
              placeholder="(Optional)"
              type="text"
              minlength="1"
              maxlength="100"
            />
          </div>
          <button type="submit">Shorten</button>
        </form>
      </div>

      <div id="error-card" class="card hidden">
        <div id="error-text">Some error lol</div>
      </div>

      <div id="result-card" class="card hidden">
        <div class="input-item">
          <label>Shortlink</label>
          <input readonly onclick="this.select();" type="text" id="from" />
        </div>
        <div id="original" class="original"></div>
      </div>
    </section>

    <script type="text/javascript">
      const form = document.getElementById("shortener-form");
      const urlInput = document.getElementsByName("url")[0];
      const slugInput = document.getElementsByName("slug")[0];
      const fromInput = document.getElementById("from");
      const originalText = document.getElementById("original");
      const resultCard = document.getElementById("result-card");
      const errorCard = document.getElementById("error-card");
      const errorText = document.getElementById("error-text");

      form.addEventListener("submit", (event) => {
        event.preventDefault();

        const submission = {
          url: urlInput.value,
          slug: slugInput.value || null,
        };

        fetch("/api/link", {
          method: "POST",
          body: JSON.stringify(submission),
          headers: {
            "Content-Type": "application/json",
          },
        }).then((res) => {
          if (res.status === 200) {
            res.json().then((link) => {
              errorCard.classList.add("hidden");
              urlInput.value = "";
              slugInput.value = "";

              fromInput.value = "https://maus.to/" + link.slug;
              fromInput.select();
              originalText.innerText = link.url;

              resultCard.classList.remove("hidden");
            });
          } else {
            res.json().then((error) => {
              errorText.innerText = error.error;
              errorCard.classList.remove("hidden");

              setTimeout(() => {
                errorCard.classList.add("hidden");
              }, 5000);
            });
          }
        });

        return false;
      });
    </script>
  </body>
</html>
